# Text Completion API
A Text Completion API that predicts the next word in a given text.

## Prerequisites
Before you begin, ensure you have the following installed:
* [Node.js](https://nodejs.org/en/docs/)
* [npm](https://docs.npmjs.com/)

## Getting Started
These instructions will get you a copy of the project up and running on your local machine for development and testing purposes.
1. Clone the repository:
```
git clone https://github.com/<your-username>/text-completion-api.git 
```
2. Navigate to the project directory:
```
cd text-completion-api 
```
3. Install the dependencies:
```
yarn install 
```
4. Create a .env file:
```
touch .env 
```
In the .env file, set the following environment variables:
```
PORT=4010

# TSOA
APP_NAME="msvc_patient"
ADMIN_USERNAME="ccchris"
ADMIN_PASSWORD="pppassword"
MS_TEMPLATE_API_KEY="abc"
# For documentation/status view

# OPENAI API
OPENAI_API_KEY="some-api-key"
OPEN_API_USING_MODEL="text-davinci-003"

TEXT_LOGGING="true"
# CHOOSE FROM true | false

# Wechat
CHAT_AGENT_ID = "SILVER"
# CHOOSE FROM SILVER | UNA

WECHAT_TOKEN="some-random-string-as-token"
WECHAT_APP_ID="some-app-id"
WECHAT_APP_SECRET="some-app-secret"


# Ggoogle
GOOGLE_APPLICATION_CREDENTIALS="google-credentials.json"


# AMAZON
AMAZON_REGION="us-west-2"
AMAZON_ACCESS_KEY_ID="some-key-id"
AMAZON_ACCESS_KEY_SECRET="some-key-secret"

# Azure
AZURE_SUBSCRIPTION_KEY="some-sub-key"
```
5. Create Google-Credential
```
touch google-credentials.json
```
In the google-credentials.json file, set the following cert variables:
```
{
  "type": "service_account",
  "project_id": "some-proejecti-t",
  "private_key_id": "some-key-id",
  "private_key": "-----BEGIN PRIVATE KEY-----
  some-private-key
  -----END PRIVATE KEY-----",
  "client_email": "some.client@email.com",
  "client_id": "some-client-id",
  "auth_uri": "some-auth-uri",
  "token_uri": "some-token-uri",
  "auth_provider_x509_cert_url": "some-cert-url",
  "client_x509_cert_url": "some-590-end-client"
}

```
*Note: google-credentials.json can be generated by gcp console.

6. Start the API server:
```
yarn tsoa:gen
yarn build
yarn init-db
yarn start
```
This will start the API server at http://localhost:4010.


## How to Use
There are two usages for this API.
### Nomral Chat Query
The API documentation for the Text Completion API can be found at http://localhost:4010/docs. This documentation includes information on the API endpoint structure, request and response payloads, and API parameters. 
The chat context to use for text completion. This should be a string with at least one sentence. For example: I'm thinking about going to the beach.
prompt: The beginning of the sentence to complete. This should be a string with at least one word. For example: What's the weather like at the beach?

1. To create a chat, make a POST request to "/v1/chat" endpoint.
```
Body {
    "title": "New Chat"
}
```
Note: if "title" is not "New Chat", the program will NOT automatically summarize the chat and create an updated title.

2. Use the `chatId` from the response of step 1 and "text" as the body to make a POST request to "/v1/line" endpoint.
```
Body {
    "text": "Tell me a joke",
    "chatId": 1
}
```

3. To view the chat info, make a GET request to "/v1/chat/detail/:chatId" endpoint, replacing ":chatId" with the actual chatId obtained from step 1.


4. To get the pure text of lines, make a GET request to "/v1/line/all/:chatId" endpoint, replacing ":chatId" with the actual chatId obtained from step 1.

### WeChat Integration

To integrate the API with WeChat, follow these steps:

Set up the {{baseURL}}/v1/wechat URL as the WeChat server URL for message token verification and event notification.

Make sure the following credentials provided by WeChat console have been set as environment variables:


```
WECHAT_TOKEN="<>"
WECHAT_APP_ID="<>"
WECHAT_APP_SECRET="<>"
```

When a user sends a message to the WeChat account, WeChat will send a POST request to the {{baseURL}}/v1/wechat URL. The API will respond with the completed sentence, which WeChat will send back to the user.
Note that the WeChat integration requires additional setup and configuration. 
For more information, please refer to the [WeChat Integration Guide](https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html).






## Technology Integration
The following technologies are integrated in this project:

### Fine-Tuning
The Text Completion API uses a fine-tuned language model for text prediction. The fine-tuning process involves training the language model on a large corpus of text data to make it more specialized for the task of text completion.

### Text-Davinci-003
The Text Completion API uses the Text-Davinci-003 language model developed by OpenAI. Text-Davinci-003 is a transformer-based language model that has been fine-tuned on a large corpus of text data for the task of text completion. It provides high-quality predictions for the next word in a given text.

## TODO
* Add more test cases
    - Increase the coverage of the test cases to ensure the API's functionality is thoroughly tested.
    - Add test cases for the model and service to ensure they are working as expected.
* Add API Key authentication
    - Implement a mechanism to secure the API by adding an API Key authentication system. This will restrict unauthorized access to the API and ensure the data being passed is secure.
    - Create an admin page where API Keys can be generated and managed. This will allow for easy management of API Keys and ensure only authorized users have access to the API.


## Built With
- [TypeScript](https://www.typescriptlang.org/) 
- [TSOA](https://github.com/lukeautry/tsoa)
- [OPENAI](https://openai.com)

## Contributing
If you'd like to contribute to the project, please fork the repository and create a pull request with your changes.

## License
This project is licensed under the MIT License.